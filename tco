local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local workspace = game:GetService("Workspace")

local LocalPlayer = Players.LocalPlayer
local plr = Players.LocalPlayer
local mouse = plr:GetMouse()
local cam = workspace.CurrentCamera
local detailedPath = false
local shovel = false
local delete = false
local rainbow = false
local rainbowSky = false
local boxMode = false
local selectedBlock = false

local material = "plastic"
local currentMaterial = "neon"
local h = 0

local block = nil
local waitingForClick = false

local function normalToFace(n)
	local a = math.abs
	if a(n.X) > a(n.Y) and a(n.X) > a(n.Z) then
		return n.X > 0 and Enum.NormalId.Right or Enum.NormalId.Left
	elseif a(n.Y) > a(n.Z) then
		return n.Y > 0 and Enum.NormalId.Top or Enum.NormalId.Bottom
	else
		return n.Z > 0 and Enum.NormalId.Back or Enum.NormalId.Front
	end
end
local paint
local function getPaintEvent()
	local char = plr.Character
	if char then
		local tool = char:FindFirstChild("Paint") or plr.Backpack:FindFirstChild("Paint")
		if tool then
			paint = tool
			local scr = tool:FindFirstChild("Script")
			if scr then
				return scr:FindFirstChild("Event")
			end
		end
	end
end

local event = getPaintEvent()


local mode = "both \240\159\164\157"

local Window = Rayfield:CreateWindow({
	Name = "controller5256's private trolling ui",
	LoadingTitle = "private and cool",
	LoadingSubtitle = "by controller5256",
	ToggleUIKeybind = "K",
	ConfigurationSaving = { Enabled = true, FileName = "Big Hub" }
})

local Tab = Window:CreateTab("main", 4483362458)

Tab:CreateButton({
	Name = "infinite yield",
	Callback = function()
		loadstring(game:HttpGet("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source"))()
	end
})

Tab:CreateDropdown({
	Name = "rainbow material",
	Options = {"smooth", "plastic", "tiles", "bricks", "planks", "ice", "neon", "toxic", "anchor"},
	CurrentOption = {"neon"},
	MultipleOptions = false,
	Flag = "MaterialDropdown",
	Callback = function(option)
		for i, v in ipairs(option) do
			currentMaterial = v
		end
	end
})

Tab:CreateToggle({
	Name = "rainbow paint",
	CurrentValue = false,
	Flag = "RainbowPaint",
	Callback = function(v)
		rainbow = v

	end
})

Tab:CreateToggle({
	Name = "shovel",
	CurrentValue = false,
	Flag = "shaval",
	Callback = function(v)
		shovel = v

	end
})

Tab:CreateToggle({
	Name = "delete",
	CurrentValue = false,
	Flag = "deeleeete",
	Callback = function(v)
		delete = v
	end
})

Tab:CreateToggle({
	Name = "rainbow sky",
	CurrentValue = false,
	Flag = "RainbowSky",
	Callback = function(v)
		rainbowSky = v

	end
})

local Button = Tab:CreateButton({
	Name = "Select Block",
	Callback = function()
		waitingForClick = true
	end,
})

mouse.Button1Down:Connect(function()
	if not waitingForClick then return end
	if mouse.Target then
		block = mouse.Target
		Rayfield:Notify({
			Title = "block selected",
			Content = "Selected block: ".. block:GetFullName(),
			Duration = 6.5,
			Image = 4483362458,
		})
	end
	waitingForClick = false
end)
local currentBlockPathType = "detailed"
local Dropdown = Tab:CreateDropdown({
	Name = "block path type",
	Options = {"normal","detailed", "rainbow detailed", "rainbow normal"},
	CurrentOption = {"detailed"},
	MultipleOptions = false,
	Flag = "Dropdown1", -- A flag is the identifier for the configuration file, make sure every element has a different flag if you're using configuration saving to ensure no overlaps
	Callback = function(Options)
		for i, v in ipairs(Options) do
			currentBlockPathType = v
		end
	end,
})

Tab:CreateToggle({
	Name = "blocks path",
	CurrentValue = false,
	Flag = "dbp",
	Callback = function(v)
		--	if not block then return end
		detailedPath = v
	end
})
local currentText = "GET NOOBED BY HUNTERSTORM"
local spraypaint = false
local Input = Tab:CreateInput({
	Name = "spray paint",
	CurrentValue = "",
	PlaceholderText = "GET NOOBED BY HUNTERSTORM",
	RemoveTextAfterFocusLost = false,
	Flag = "Input1",
	Callback = function(Text)
		currentText = Text
	end,
})

Tab:CreateToggle({
	Name = "spray paint",
	CurrentValue = false,
	Flag = "dbp",
	Callback = function(v)
		--	if not block then return end
		spraypaint = v
	end
})
local ka = false
Tab:CreateToggle({
	Name = "kill aura",
	CurrentValue = false,
	Flag = "dbp",
	Callback = function(v)
		--	if not block then return end
		ka = v
		print(ka)
		print("2: ".. tostring(v))
	end
})


local deleteEvent = plr:WaitForChild("Backpack"):WaitForChild("Delete"):WaitForChild("Script"):WaitForChild("Event")
local shovelEvent = plr:WaitForChild("Backpack"):WaitForChild("Shovel"):WaitForChild("Script"):WaitForChild("Event")
local function refreshTools()
	local char = plr.Character
	if not char then return end

	local backpack = plr.Backpack

	local function findTool(toolName)
		return char:FindFirstChild(toolName) or backpack:FindFirstChild(toolName)
	end

	local paintTool = findTool("Paint")
	event = paintTool and paintTool:FindFirstChild("Script") and paintTool.Script:FindFirstChild("Event") or nil

	local shovelTool = findTool("Shovel")
	shovelEvent = shovelTool and shovelTool:FindFirstChild("Script") and shovelTool.Script:FindFirstChild("Event") or nil

	local deleteTool = findTool("Delete")
	deleteEvent = deleteTool and deleteTool:FindFirstChild("Script") and deleteTool.Script:FindFirstChild("Event") or nil
end

local Tab = Window:CreateTab("settings", 4483362458)

local Button = Tab:CreateButton({
	Name = "reset tool variables",
	Callback = function()
		refreshTools()
	end,
})

local Players = game:GetService("Players")

local function hasEnlighten(plr)
	if plr.Backpack and plr.Backpack:FindFirstChild("The Arkenstone") then
		return true
	end
	if plr.Character and plr.Character:FindFirstChild("The Arkenstone") then
		return true
	end
	return false
end

local function createHighlight(char)
	local h = Instance.new("Highlight")
	h.Name = "EnliHighlight"
	h.FillColor = Color3.fromRGB(150, 200, 255)
	h.OutlineColor = Color3.fromRGB(150, 200, 255)
	h.FillTransparency = 0.8
	h.OutlineTransparency = 0
	h.Parent = char
	return h
end
local function checkEnli(plr)
	task.spawn(function()
		while task.wait(0.5) do
			local char = plr.Character
			if not char then continue end

			local hasEnli = hasEnlighten(plr)
			local wasInvisible = false
--[[
			for _, v in char:GetChildren() do
				if v:IsA("BasePart") and v.Transparency ~= 0 and v.Name ~= "HumanoidRootPart" then
					v.Transparency = 0
					wasInvisible = true
				end
			end
]]
			local highlight = char:FindFirstChild("EnliHighlight")

		--	if wasInvisible then
				if not highlight then
					highlight = createHighlight(char)
				end

				if hasEnli then
					highlight.FillColor = Color3.fromRGB(170, 0, 255)
					highlight.OutlineColor = Color3.fromRGB(170, 0, 255)
				else
					highlight.FillColor = Color3.fromRGB(255, 0, 0)
					highlight.OutlineColor = Color3.fromRGB(255, 0, 0)
				end
			--else
				if highlight then
					highlight:Destroy()
				end
			--end
		end
	end)

	plr.CharacterAdded:Connect(function(char)
		local old = char:FindFirstChild("EnliHighlight")
		if old then
			old:Destroy()
		end
	end)
end


for _, plr in ipairs(Players:GetPlayers()) do
	checkEnli(plr)
end

Players.PlayerAdded:Connect(checkEnli)
local rayParams = RaycastParams.new()
rayParams.FilterType = Enum.RaycastFilterType.Blacklist
rayParams.FilterDescendantsInstances = { plr.Character }
local char = plr.Character or plr.characterAdded:Wait()

local function getNearestBlock(pos)
	local folder = workspace:FindFirstChild("Bricks")
	if not folder then return end

	local playerFolder = folder:FindFirstChild(plr.Name)
	if not playerFolder then return end

	local nearest, nearestDist

	for _, p in ipairs(playerFolder:GetDescendants()) do
		if p:IsA("BasePart") then
			local d = (p.Position - pos).Magnitude
			if not nearestDist or d < nearestDist then
				nearest = p
				nearestDist = d
			end
		end
	end

	return nearest
end


local function sneakyforceEquip(gear)
	local t = plr.Backpack:FindFirstChild(gear)
	if t then
		t.Parent = plr.Character
		t.Parent = plr.Backpack
		print("SET GEAR: ".. gear)
	end
	return t
end
local function forceEquip(gear)
	local t = plr.Backpack:FindFirstChild(gear)
	if t then
		t.Parent = plr.Character
		print("SET GEAR: ".. gear)
	end
	return t
end



local function normalToNormalId(n)
	local ax = math.abs(n.X)
	local ay = math.abs(n.Y)
	local az = math.abs(n.Z)

	if ay > ax and ay > az then
		return n.Y > 0 and Enum.NormalId.Top or Enum.NormalId.Bottom
	elseif ax > ay and ax > az then
		return n.X > 0 and Enum.NormalId.Right or Enum.NormalId.Left
	else
		return n.Z > 0 and Enum.NormalId.Back or Enum.NormalId.Front
	end
end


local function sprayNearbyBricks(hitPos, hitNormal, col, currentText)
	local params = OverlapParams.new()
	params.FilterType = Enum.RaycastFilterType.Whitelist
	params.FilterDescendantsInstances = { workspace.Bricks }

	local parts = workspace:GetPartBoundsInBox(
		CFrame.new(hitPos),
		Vector3.new(5, 5, 5),
		params
	)

	local normalId = normalToNormalId(hitNormal)
	if not normalId then return end

	for _, part in ipairs(parts) do
		if part:IsA("BasePart") then
			event:FireServer(
				part,
				normalId,
				vector.create(hitPos.X, hitPos.Y, hitPos.Z),
				"both \240\159\164\157",
				col,
				"spray",
				currentText
			)
		end
	end
end



local function getNearestHRP(position)
	print("GetnearestHRP is running")
	local nearestHRP = nil
	local maxDistance = 20

	for _, plr in ipairs(Players:GetPlayers()) do
		if plr ~= LocalPlayer then
			local char = plr.Character
			local humanoid = char:FindFirstChild("Humanoid")
			if humanoid.Health <= 0 then return end
			local hrp = char and char:FindFirstChild("HumanoidRootPart")
			if hrp then
				local dist = (hrp.Position - position).Magnitude
				if dist < maxDistance then
					maxDistance = dist
					nearestHRP = hrp
					
				end
			end
		end
	end
	print(nearestHRP.Parent.Name, "is the nearestHRP")
	print(maxDistance)
	return nearestHRP
end



--[[
task.spawn(function()
	while task.wait(0.5) do
		print("rainbow: ".. tostring(rainbow))
		print("shovel: ".. tostring(shovel))
		print("delete: ".. tostring(delete))
		print("rainbowSky: ".. tostring(rainbowSky))
		print("detailedPath: ".. tostring(detailedPath))
		print("spraypaint: ".. tostring(spraypaint))
		print("ka: ".. tostring(ka))
		print("currentMaterial: ".. tostring(currentMaterial))
		print("currentBlockPathType: ".. tostring(currentBlockPathType))
		print("currentText: ".. tostring(currentText))
		print("deleteevent: ".. tostring(deleteEvent))
	end
end)
]]
mouse.Button1Down:Connect(function()
	if not spraypaint then return end

	local target = mouse.Target
	if not target then return end

	refreshTools()
	if not event then return end

	local origin = cam.CFrame.Position
	local hitPos = mouse.Hit.Position
	local direction = (hitPos - origin) * 500

	local result = workspace:Raycast(origin, direction, rayParams)
	if not result then return end

	sprayNearbyBricks(
		result.Position,
		result.Normal,
		Color3.fromHSV(h, 1, 1),
		currentText
	)
end)

local function checkForTools()
	shovel = LocalPlayer.Character:FindFirstChild("Shovel")
	if not shovel then
		shovel = LocalPlayer.Backpack:FindFirstChild("Shovel")
	end
	delete = LocalPlayer.Character:FindFirstChild("Delete")
	if not delete then
		delete = LocalPlayer.Backpack:FindFirstChild("Delete")
	end
	paint = LocalPlayer.Character:FindFirstChild("Paint")
	if not paint then
		paint = LocalPlayer.Backpack:FindFirstChild("Paint")
	end
end

local function createToxicBlock(position)
	local nearest = getNearestHRP(position)
	if not nearest then return end

	local buildTool = sneakyforceEquip("Build")
	local paint = sneakyforceEquip("Paint")

	local scr = buildTool and buildTool:FindFirstChild("Script")
	if scr then
		local event = scr:FindFirstChild("Event")
		if event then
			local args = {workspace.Terrain, Enum.NormalId.Top, nearest.Position, "detailed"}
			event:FireServer(unpack(args))
		end
	end

	local bricksFolder = workspace:WaitForChild("Bricks"):WaitForChild(plr.Name)
	local newBlock
	local conn
	conn = bricksFolder.ChildAdded:Connect(function(child)
		newBlock = child
		conn:Disconnect()
	end)
	repeat task.wait() until newBlock

	return newBlock
end

local unacnhorDebounce = false
RunService.RenderStepped:Connect(function()
	if  shovelEvent
		or deleteEvent
		or not event then
		refreshTools()
	end


	h = h + 0.005
	if h > 1 then h = 0 end
	local col = Color3.fromHSV(h, 1, 1)
	local origin = cam.CFrame.Position
	local direction = Vector3.new()
	if detailedPath then
		local hrp = plr.Character and plr.Character:FindFirstChild("HumanoidRootPart")
		if not hrp then return end

		local pathType = currentBlockPathType
		local isRainbowPath = pathType == "rainbow detailed" or pathType == "rainbow normal"

		if isRainbowPath or currentMaterial == "anchor" then
			forceEquip("Paint")
			forceEquip("Build")
			pathType = pathType:gsub("rainbow ","")
		end
		local args = {workspace.Terrain, Enum.NormalId.Top, hrp.Position, pathType}
		local buildTool = plr.Character:FindFirstChild("Build")
		if buildTool then
			local scr = buildTool:FindFirstChild("Script")
			if scr and scr:FindFirstChild("Event") then
				scr.Event:FireServer(unpack(args))
			end
		end

		if isRainbowPath and event or currentMaterial == "anchor" then
			local nearest = getNearestBlock(hrp.Position)
			if nearest then
				if currentMaterial == "anchor" then
					if nearest.Anchored == true then
						event:FireServer(
							nearest,
							normalToFace(nearest.Position),
							vector.create(nearest.Position.X, nearest.Position.Y, nearest.Position.Z),
							"both \240\159\164\157",
							Color3.new(1,1,1),
							"anchor",
							""
						)
					end
				else
					event:FireServer(
						nearest,
						normalToFace(nearest.Position),
						vector.create(nearest.Position.X, nearest.Position.Y, nearest.Position.Z),
						"both \240\159\164\157",
						col,
						currentMaterial,
						""
					)
				end
				
			end
		end
	end
	if rainbow or rainbowSky or boxMode or selectedBlock or shovel or delete or spraypaint or ka then
		local hitPos = mouse.Hit.Position
		direction = hitPos - origin

		if direction.Magnitude <= 0 then return end
		direction = direction.Unit * 1000

		local result = workspace:Raycast(origin, direction, rayParams)

		if shovel then
			if result then
				local args = {
					workspace:WaitForChild("Terrain"),
					Enum.NormalId.Top,
					result.Position,
					"dig"
				}
				shovelEvent:FireServer(unpack(args))
			end

		elseif ka == true then
			local character = plr.Character
			if character and character:FindFirstChild("HumanoidRootPart") then
				local block = createToxicBlock(character.HumanoidRootPart.Position)
				event:FireServer(
					block,
					Enum.NormalId.Top,
					Vector3.new(block.Position.X, block.Position.Y, block.Position.Z),
					"both \240\159\164\157",
					Color3.new(0, 0, 0),
					"toxic",
					""
				)
			end
		elseif delete then
			if result then
				deleteEvent:FireServer(result.Instance, result.Position)
			end

		elseif rainbow then
			event:FireServer(
				result and result.Instance or workspace.Terrain,
				normalToFace(result and result.Position or Vector3.new(0,1,0)),
				vector.create(hitPos.X, hitPos.Y, hitPos.Z),
				mode,
				col,
				currentMaterial,
				""
			)

		elseif rainbowSky then
			event:FireServer(
				Enum.NormalId.Right,
				vector.create(9468.4033203125, 3084.64111328125, 707.554443359375),
				mode,
				col,
				"neon",
				""
			)

		elseif selectedBlock then
			event:FireServer(
				block or (result and result.Instance) or workspace.Terrain,
				normalToFace(
					block and block.Position
						or result and result.Position
						or Vector3.new(0,1,0)
				),
				vector.create(hitPos.X, hitPos.Y, hitPos.Z),
				mode,
				col,
				currentMaterial,
				""
			)
		end
	end
end)
